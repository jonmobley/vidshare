<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>VidShare - Vertical Video Gallery</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme colors -->
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="VidShare">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="VidShare">
    
    <!-- Prevent zooming -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-128x128.png">
    
    <!-- Standard Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- SEO and Social -->
    <meta name="description" content="Immersive TikTok-style vertical video gallery experience">
    <meta name="keywords" content="video, gallery, vertical, mobile, app, entertainment">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/controls.css">
</head>
<body>
    <!-- Category Navigation -->
    <div class="category-navigation">
        <div class="category-pills-container" id="categoryPillsContainer">
            <div class="category-pills" id="categoryPills">
                <div class="category-pill active" data-category="0">For You</div>
                <div class="category-pill" data-category="1">Gaming</div>
                <div class="category-pill" data-category="2">Music</div>
                <div class="category-pill" data-category="3">Videos</div>
            </div>
        </div>
    </div>

    <!-- Main Video Container -->
    <div class="video-container" id="videoContainer">
        <div class="video-wrapper" id="videoWrapper">
            <!-- Video slides will be dynamically created here -->
        </div>
    </div>

    <!-- Controls -->
    <div class="controls-container" id="controlsContainer">
        <button class="control-button like-control" title="Like">
            <svg class="like-icon" viewBox="0 0 24 24">
                <path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>
            </svg>
        </button>
        <button class="control-button share-control" title="Share">
            <svg class="share-icon" viewBox="0 0 24 24">
                <path d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.6 20.92,19A2.84,2.84 0 0,0 18,16.08Z"/>
            </svg>
        </button>
        <button class="control-button download-control" title="Download">
            <svg class="download-icon" viewBox="0 0 24 24">
                <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
            </svg>
        </button>
        <button class="control-button autoplay-control" title="Autoplay Settings">
            <svg class="autoplay-icon" viewBox="0 0 24 24">
                <path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11.03L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11.03L19.5,12L19.43,12.97L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z"/>
            </svg>
        </button>
        <button class="control-button volume-control" title="Toggle sound">
            <svg class="volume-icon" viewBox="0 0 24 24">
                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
        </button>
    </div>

    <!-- Autoplay Settings Panel -->
    <div class="autoplay-settings-panel" id="autoplaySettingsPanel">
        <div class="autoplay-option active" data-mode="loop">
            <svg class="autoplay-option-icon" viewBox="0 0 24 24">
                <path d="M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12H4A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"/>
            </svg>
            <span class="autoplay-option-text">Loop</span>
        </div>
        <div class="autoplay-option" data-mode="pause">
            <svg class="autoplay-option-icon" viewBox="0 0 24 24">
                <path d="M14,19H18V5H14M6,19H10V5H6V19Z"/>
            </svg>
            <span class="autoplay-option-text">Pause at end</span>
        </div>
        <div class="autoplay-option" data-mode="next">
            <svg class="autoplay-option-icon" viewBox="0 0 24 24">
                <path d="M4,18L12.5,12L4,6V18M13,6V18H16V6H13Z"/>
            </svg>
            <span class="autoplay-option-text">Auto next</span>
        </div>
    </div>

    <!-- Video Progress Bar -->
    <div class="video-progress-container">
        <div class="video-progress-bar" id="videoProgress"></div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-indicator" id="progressIndicator">
        <!-- Dots will be dynamically generated -->
    </div>

    <!-- Performance Stats (Debug) -->
    <div class="performance-stats" id="performanceStats">
        <div>Rendered Videos: <span id="renderedCount">0</span></div>
        <div>Total Videos: <span id="totalCount">0</span></div>
        <div>Current Position: <span id="currentIndex">0</span></div>
        <div>Memory Usage: <span id="memoryUsage">0</span>MB</div>
        <div>Pool Status: <span id="poolStatus">0/0</span></div>
        <div><small>Virtual scrolling ready to scale</small></div>
        <div><small>Press 'P' to toggle</small></div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/main.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/vertical/sw.js')
                    .then(registration => {
                        console.log('✅ PWA Service Worker registered:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('🔄 New version available! Refresh to update.');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('❌ PWA Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        let isInstalled = false;

        // Check if app is already installed
        if (window.matchMedia('(display-mode: fullscreen)').matches || 
            window.matchMedia('(display-mode: standalone)').matches) {
            isInstalled = true;
            console.log('📱 App is running in installed mode');
        }

        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('📲 Install prompt available');
            
            // Show custom install button/banner if needed
            showInstallPrompt();
        });

        // Handle successful installation
        window.addEventListener('appinstalled', (e) => {
            console.log('🎉 VidShare PWA installed successfully!');
            isInstalled = true;
            hideInstallPrompt();
        });

        function showInstallPrompt() {
            // You can create a custom install banner here
            console.log('💡 App can be installed to homescreen');
        }

        function hideInstallPrompt() {
            // Hide any custom install UI
            console.log('✅ Install prompt hidden');
        }

        // Optional: Trigger install programmatically
        function installApp() {
            if (deferredPrompt && !isInstalled) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('👍 User accepted the install prompt');
                    } else {
                        console.log('👎 User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Expose install function globally
        window.installVidShareApp = installApp;

        // Lock orientation to portrait when possible
        function lockOrientation() {
            if (screen && screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('portrait-primary').catch((err) => {
                    console.log('🔒 Screen orientation lock not supported or failed:', err.message);
                });
            } else if (screen && screen.lockOrientation) {
                // Older API
                screen.lockOrientation('portrait-primary');
            } else {
                console.log('📱 Screen orientation lock not supported');
            }
        }

        // Lock orientation when app becomes fullscreen/standalone
        if (window.matchMedia('(display-mode: fullscreen)').matches || 
            window.matchMedia('(display-mode: standalone)').matches) {
            lockOrientation();
        }

        // Also try to lock when page loads
        window.addEventListener('load', () => {
            setTimeout(lockOrientation, 100);
        });
    </script>
</body>
</html>
